<html>
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <link rel="stylesheet" href="../build/main.css">
    <link rel="stylesheet" href="./example.css">
  </head>
  <body>

    <script src="../build/okeyground.js"></script>

    <section>
    <div class="okeyground normal" id="ground7"></div>
    <button onclick="openSeries(window.ground1)">Open Series</button>
    <button onclick="openPairs(window.ground1)">Open Pairs</button>
    <button onclick="getFen(window.ground1)">Log Fen</button>
    <button onclick="getPieceGroupOpens(window.ground1)">Log Opens</button>
    <button onclick="opponentOpenPairs(window.ground1)">Opponent Open Pairs</button>
    <script>

     function delay(f, d) {
       d = d | 1000;
       setTimeout(f, d);
     }

     function setTurn(ground, side) {
       ground.set({
         turnSide: side
       });
     }

     function openSeries(ground) {
       ground.playOpenSeries();
     }

     function openPairs(ground) {
       ground.playOpenPairs();
     }

     function leaveTaken(ground) {
       ground.playLeaveTaken();
     }

     function getPieceGroupOpens(ground) {
       console.log(ground.getPieceGroupSeries(ground));
       console.log(ground.getPieceGroupPairs(ground));
     }

     function getFen(ground) {
       var fen = ground.getFen();
       console.log(fen);

       ground.set({
         fen: [fen, "", "", "", "20r1", "e"].join("/")
       });
     }

     function opponentOpenPairs(ground) {
       var pairs = ground.getPieceGroupPairs(ground);

       ground.set({
         turnSide: 'north'
       });
       ground.apiMove('op', pairs);
       ground.set({
         turnSide: 'east'
       });
     }

     function opponentOpenSeries(ground) {
       var series = ground.getPieceGroupSeries(ground);

       ground.set({
         turnSide: 'north'
       });
       ground.apiMove('os', series);
       ground.set({
         turnSide: 'east'
       });
     }

     function aiMove(ground, side) {
       console.log('draw middle', side);
       ground.apiMove('dm');
       delay(function() {
         console.log('discard ', side);
         ground.apiMove('dd', 'l10');
         setTurn(ground, side);
       });
     }

     function aiMoveLeft(ground, side) {
       console.log('draw left', side);
       ground.apiMove('dl');
       delay(function() {
         console.log('leave taken', side);
         ground.apiMove('lt', 'r9');
       });
       delay(function() {
         console.log('draw left', side);
         ground.apiMove('dl');
       }, 1500);
       delay(function() {
         console.log('discard ', side);
         ground.apiMove('dd', 'l10');
         setTurn(ground, side);
       }, 2000);
     }

     (function() {
       var ground;
       ground = Okeyground(document.getElementById('ground7'), {
         events: {
           move: function(key, piece) {
             console.log('events move', key, piece);

             if (key === 'dm') {
               setTimeout(function() {
                 ground.apiDrawMiddleEnd('r10')
               }, 1000);
             }
           }
         },
         movable: {
           dests: ['dd', 'dl', 'dm', 'do', 'os', 'op'],
           events: {
             after: function(key, piece) {
               console.log('movable events after', key, piece);
               //onMove();
             }
           }
         }
       });

       window.ground1 = ground;

       var onMove = function() {
         setTurn(ground, 'north');
         delay(aiMove.bind(null, ground, 'west'), 1000);
         delay(aiMove.bind(null, ground, 'south'), 4000);
         delay(aiMove.bind(null, ground, 'east'), 8000);
       };
       var onMoveLeft = function() {
         console.log('move left');
         setTurn(ground, 'north');
         delay(aiMoveLeft.bind(null, ground, 'west'), 1000);
         delay(aiMoveLeft.bind(null, ground, 'south'), 4000);
         delay(aiMoveLeft.bind(null, ground, 'east'), 8000);
       };
       //onMove();
       //delay(onMoveLeft.bind(null), 12000);
     })();
    </script>
    </section>

    <section>
      <div class="okeyground small" id="ground8"></div>
      <script>
       (function() {
         var ground;
         ground = Okeyground(document.getElementById('ground8'), {});
       })();
      </script>
    </section>

    <section>
      <div class="okeyground large" id="ground9"></div>
      <script>
       (function() {
         var ground;
        var initial = 'r1r2 r3r4r5r6r7r8r9r10r11r12r13l1l2l3l4l5l6l7   g1g2  l3';
        var initialMiddles = '20l3';
        var initialDiscards = ' r2r3l1';
        var initialOpenGroups = `r8l8b8
        b1b2b3
        b9b10b11b12
        l13r13b13
        r12b12g12
        r7r8r9r10
        g10g11g12
        l6b6r6
        l9l10l11
        b7l7r7g7
        r13l13b13g13
        l10r10b10g10
        l6r6g6
        l1b1g1
        /r1r1
        g1g1
        g2g2
        g3g3
        g4g4
        g5g5
        g6g6
        g7g7
        g8g8
        g9g9
        g10g10
        g11g11
        g12g12

        `;

         var fen = [initial, initialDiscards, initialOpenGroups, initialMiddles, 'n'].join('/');

         fen = "l5l10g10g13l2l2l2l2l2l2l2l2l2l2l2l2l4l6g11g1g8/r10l2b3 l2g5l2 l2b6 g12b13l10///9g2/s";

         ground = Okeyground(document.getElementById('ground9'), {fen: fen});
       })();
      </script>
    </section>

  </body>
</html>
